<!DOCTYPE html>
<html>
<head>
	<title></title>
	 <link rel="stylesheet" href="styles/main.css">
    <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
</head>
<body>
	<div id="chatContainer">
		<div id="chatWindow" >
			<ul v-for="message in messages" :key="message">
				<li class="chatMessage">{{ message }}</li>
			</ul>
		</div>
		<form onsubmit="sendMessage($('#chatBox').val()); return false;" >
			<input type="text"   id="chatBox"    value="" autocomplete="off" />
			<input type="submit" id="chatSubmit" value="Send"  />
		</form>
	</div>


    <script src="scripts/Vue.js"></script>
	<script src="http://localhost:8080/socket.io/socket.io.js"></script>
	<script>
		var socket = io('http://localhost:8080');
		socket.on('connect',    function(    ){console.log('connect'    )});

		socket.on('disconnect', function(    ){console.log('disconnect' )});

		socket.on('fail',       function(data){console.log( data)});

		socket.on('prompt-un',       function(data){
			var un = prompt('Please enter a username:')
			if (!un || un.length > 0)
			{
				socket.emit('un', {username: un})
			}
		});
		socket.on('alert',       function(msg){
			alert(msg);
		});

		socket.on('chat', function(data){
			var message = data.msg
			if (data.showName){
				if (data.isSelf){
					message = 'you: ' + message;
				} else {
					message = data.un + ': ' + message;
				}
			}
			var color = '';
			var messageStyles = '';
			if (data.color) {
				messageStyles += "color:" + data.color +";"
			} else {
				messageStyles += "color:#000000;"
			}
			if (data.whisper) {
				messageStyles += "font-style: italic;"
			}

			chatMessages.messages.push(message)

			// var html = '<div class="chatMessage" style="' + messageStyles + '" title="' + data.timestamp + '">' + message + '</div>';
			// $("#chatWindow").append(html)
		});

		var sendMessage = function(msg)
		{
			if (!socket) {
				console.warn("no socket");
				return;
			}
			$("#chatBox").val('')
			socket.emit('message', {message: msg})
		}
	</script>
</body>
</html>